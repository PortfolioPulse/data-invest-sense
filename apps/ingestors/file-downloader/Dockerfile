FROM python:3.10-slim-buster

ARG SERVICE_NAME
ARG CONTEXT_ENV
ARG GATEWAY_ENVIRONMENT
ARG RABBITMQ_PORT_6572_TCP
ARG RABBITMQ_GATEWAY_HOST
ARG LAKE_CONTROLLER_PORT_8000_TCP
ARG LAKE_CONTROLLER_GATEWAY_HOST
ARG MINIO_PORT_9000_TCP
ARG MINIO_GATEWAY_HOST
ARG MINIO_ACCESS_KEY
ARG MINIO_SECRET_KEY

ENV SERVICE_NAME=$SERVICE_NAME
ENV CONTEXT_ENV=$CONTEXT_ENV
ENV GATEWAY_ENVIRONMENT=$GATEWAY_ENVIRONMENT
ENV RABBITMQ_PORT_6572_TCP=$RABBITMQ_PORT_6572_TCP
ENV RABBITMQ_GATEWAY_HOST=$RABBITMQ_GATEWAY_HOST
ENV LAKE_CONTROLLER_PORT_8000_TCP=$LAKE_CONTROLLER_PORT_8000_TCP
ENV LAKE_CONTROLLER_GATEWAY_HOST=$LAKE_CONTROLLER_GATEWAY_HOST
ENV MINIO_PORT_9000_TCP=$MINIO_PORT_9000_TCP
ENV MINIO_GATEWAY_HOST=$MINIO_GATEWAY_HOST
ENV MINIO_ACCESS_KEY=$MINIO_ACCESS_KEY
ENV MINIO_SECRET_KEY=$MINIO_SECRET_KEY

WORKDIR /app

COPY dist/*.tar.gz .
RUN pip install *.tar.gz
RUN rm -rf *.tar.gz

COPY file_downloader/ file_downloader/

ENTRYPOINT ["python", "file_downloader/main.py"]
